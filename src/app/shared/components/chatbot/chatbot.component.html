<!-- <!-- Floating toggle button -->
<button *ngIf="!isChatOpen()"
        class="btn rounded-circle shadow-lg position-fixed bottom-0 end-0 m-4 chat-toggle-btn"
        style="width: 60px; height: 60px; z-index: 1050;
               background: linear-gradient(135deg, #ff80ab, #80d8ff); border: none;"
        (click)="toggleChat()">
  <i class="bi bi-chat-dots fs-3 text-white"></i>
</button>

<!-- Chat box -->
<div *ngIf="isChatOpen()" class="position-fixed bottom-0 end-0 m-4 shadow-lg"
     style="width: 350px; height: 470px; z-index: 1040; border-radius: 1rem; overflow: hidden;">
  <div class="d-flex flex-column h-100 bg-light rounded-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center px-3 py-2 text-white"
         style="background: linear-gradient(135deg, #ff80ab, #80d8ff);">
      <h6 class="mb-0 fw-bold " style="color: #2db9f5;">
        <i class="bi bi-robot me-2 fs-5" style="color: #2db9f5;" ></i> Baby bot
      </h6>
      <span *ngIf="api.loading()" class="small">...Responding</span>
      <button class="btn btn-sm btn-light rounded-circle" (click)="closeChat()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Messages -->
    <div class="flex-grow-1 overflow-auto px-3 py-3" style="background-color: #f8f9fa;" #scrollHost>
      <div *ngFor="let m of messages(); let i = index" class="mb-3">
        <div [ngClass]="{
              'text-end': m.role === 'user',
              'text-start': m.role === 'assistant'
            }">

          <!-- Message bubble -->
          <div class="px-3 py-2 shadow-sm"
               [ngClass]="{
                 'ms-auto': m.role === 'user',
                 'me-auto': m.role === 'assistant'
               }"
               [ngStyle]="m.role === 'user'
                 ? {
                     background: 'linear-gradient(135deg, #ff80ab, #80d8ff)',
                     color: 'white',
                     borderRadius: '20px 20px 0px 20px',
                     maxWidth: '80%',
                     whiteSpace: 'pre-wrap'
                   }
                 : {
                     background: '#e9ecef',
                     color: '#333',
                     borderRadius: '20px 20px 20px 0px',
                     maxWidth: '80%',
                     whiteSpace: 'pre-wrap'
                   }">

            <!-- Sender name -->
            <div class="small fw-bold mb-1"
                 [ngStyle]="m.role === 'user'
                   ? { color: '#f0f0f0' }
                   : { color: '#6c757d' }">

              <ng-container *ngIf="m.role === 'user'; else botLabel">
                You:
              </ng-container>

              <ng-template #botLabel>
                <i class="bi bi-robot me-2 fs-5" style="color: #55ccff;"></i>
                Baby bot:
              </ng-template>

            </div>

            <!-- Message content -->
            <div>{{ m.text }}</div>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="api.loading()" class="text-center my-3">
        <div class="spinner-border text-primary spinner-border-sm" role="status"></div>
      </div>
    </div>

    <!-- Input -->
    <div class="input-group p-2 border-top bg-white" style="gap: 8px;">
      <input type="text" [(ngModel)]="draft" name="draft"
             class="form-control rounded-start border-0 shadow-none"
             placeholder="Ask about a product, price, or order status..."
             [disabled]="api.loading()"
             (keyup.enter)="onSend()">
      <button class="btn text-white rounded-end px-4"
              style="background: linear-gradient(135deg, #ff80ab, #80d8ff); border: none;"
              [disabled]="!draft.trim() || api.loading()"
              (click)="onSend()">
        <i class="bi bi-send-fill"></i>
      </button>
    </div>

  </div>
</div>


