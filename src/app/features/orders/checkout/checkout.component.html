<div class="body">
  <div class="container mt-4">
  <h2><i class="bi bi-cart-check"></i> Checkout</h2>
  <p class="text-muted">
    Enter your shipping details to proceed with the order
  </p>
  <div *ngIf="!isSwapOrder" class="alert alert-info" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    <strong>Shipping Fee:</strong> A fixed shipping fee of
    {{ REGULAR_SHIPPING_FEE | number:'1.2-2' }} EGP will be
    added to your order.
  </div>
  <div *ngIf="isSwapOrder" class="alert alert-warning" role="alert">
    <i class="bi bi-arrow-repeat me-2"></i>
    <strong>Exchange Order:</strong> This is an exchange order. Only shipping
    fee of {{ SWAP_SHIPPING_FEE | number:'1.2-2' }} EGP will
    be charged.
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-spinner text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Checkout Form -->
  <div *ngIf="!isLoading && product && product.id" class="row">
    <div class="col-md-8">
      <form #checkoutForm="ngForm" (ngSubmit)="onSubmit()">
        <div class="card shadow-sm p-4">
          <h5>Shipping Information</h5>
          <div class="mb-3">
            <label for="recipientName" class="form-label">Recipient Name</label>
            <input
              type="text"
              class="form-control"
              id="recipientName"
              name="recipientName"
              [(ngModel)]="shippingInfo.recipientName"
              required
              #recipientName="ngModel"
               (focus)="showTooltip('recipientName')"
              
              readonly
            />
       <div class="form-text text-warning" [hidden]="!tooltips.recipientName">
    To change Recipient Name, please update your profile.
  </div></div>
          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input
              type="text"
              class="form-control"
              id="address"
              name="address"
              [(ngModel)]="shippingInfo.address"
              required
              #address="ngModel"
              (focus)="showTooltip('address')"
              readonly
            />
            <div class="form-text text-warning" [hidden]="!tooltips.address">
    To change  Address, please update your profile.
  </div></div>
          
          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input
              type="text"
              class="form-control"
              id="city"
              name="city"
              [(ngModel)]="shippingInfo.city"
              required
              #city="ngModel"
              (focus)="showTooltip('city')"
              readonly
            />
            <div class="form-text text-warning" [hidden]="!tooltips.city">
    To change City, please update your profile.
  </div>
          </div>
          <div class="mb-3">
            <label for="postalCode" class="form-label">Postal Code</label>
            <input
              type="text"
              class="form-control"
              id="postalCode"
              name="postalCode"
              [(ngModel)]="shippingInfo.postalCode"
              required
              #postalCode="ngModel"
             (focus)="showTooltip('postalCode')"
              readonly
            />
          
         <div class="form-text text-warning" [hidden]="!tooltips.postalCode">
    To change Postal Code, please update your profile.
  </div></div>
          <div class="mb-3">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input
              type="text"
              class="form-control"
              id="phoneNumber"
              name="phoneNumber"
              [(ngModel)]="shippingInfo.phoneNumber"
              required
              #phoneNumber="ngModel"
           (focus)="showTooltip('phoneNumber')"
              readonly
            />
         
          <div class="form-text text-warning" [hidden]="!tooltips.phoneNumber">
    To change Phone Number, please update your profile.
  </div></div>
          <div class="mb-3">
            <input
              type="number"
              class="form-control"
              id="quantity"
              name="quantity"
              [(ngModel)]="orderRequest.quantity"
              min="1"
              required
              #quantity="ngModel"
              (ngModelChange)="calculateTotal()"
              hidden
            />
       
           
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="text-primary mb-0">
               Total: {{ totalAmount | number:'1.0-0' }} EGP
              </h5>
              <small class="text-muted" *ngIf="!isSwapOrder">
                Includes
                {{
                  REGULAR_SHIPPING_FEE | number:'1.2-2' }} EGP
                shipping fee
              </small>
              <small class="text-muted" *ngIf="isSwapOrder">
                Exchange order - shipping fee only
              </small>
            </div>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="checkoutForm.invalid || isLoading"
              [attr.aria-disabled]="isLoading ? true : null"
            >
              <i class="bi bi-credit-card"></i> Proceed to Payment
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm p-4">
        <h5>Order Summary</h5>
        <div *ngIf="product" class="d-flex align-items-center mb-3">
          <img
            [src]="getProductImage()"
            (error)="onImageError($event)"
            class="rounded me-3"
            style="width: 80px; height: 80px; object-fit: cover"
            [alt]="product.title || 'Product'"
          />
          <div>
            <h6 class="mb-1">{{ product.title || "Unknown Product" }}</h6>
            <p class="text-muted mb-1">
              Sold by: {{ product.userName || "Unknown Seller" }}
            </p>
            <p class="text-primary mb-0">
              {{
                product.price
                  ? (product.price | number:'1.0-0' )
                  : "0.00"
              }} EGP
            </p>
          </div>
        </div>
        <hr />
        <div class="d-flex justify-content-between" *ngIf="!isSwapOrder">
          <span>Subtotal</span>
          <span>{{
            product && product.price && orderRequest.quantity
              ? (product.price * orderRequest.quantity
                | currency | number:'1.0-0')
              : "0.00"
          }} EGP</span>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <span>Shipping Fee</span>
          <span>{{
            isSwapOrder
              ? SWAP_SHIPPING_FEE
              : (REGULAR_SHIPPING_FEE | number: "1.2-2")
          }} EGP</span>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <strong>Total</strong>
          <strong class="text-primary">{{
            totalAmount | number:"1.0-0"}} EGP</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty Product State -->
  <div *ngIf="!isLoading && !product" class="text-center py-5">
    <div class="empty-state">
      <i class="bi bi-cart display-1 text-muted mb-3"></i>
      <h3>No product selected</h3>
      <p class="text-muted mb-4">
        Please select a product to proceed with checkout.
      </p>
      <a routerLink="/products" class="btn btn-primary">Shop Now</a>
    </div>
  </div>
</div>

</div>