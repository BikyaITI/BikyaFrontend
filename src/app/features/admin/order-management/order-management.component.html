<div class="container">
  <h2 class="mb-4">Admin Order Management</h2>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="my-3 text-center" role="status" aria-live="polite">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading orders...</span>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i> {{ errorMessage }}
  </div>

  <!-- Search and Filter Controls -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="searchInput" class="visually-hidden">Search orders</label>
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search" aria-hidden="true"></i></span>
        <input type="text"
               id="searchInput"
               class="form-control"
               placeholder="Search orders... (Press Enter to search)"
               [(ngModel)]="searchTerm"
               (input)="searchOrders()"
               (keydown.enter)="searchOrders()"
               aria-label="Search orders by product, buyer, or seller">
      </div>
    </div>
    <div class="col-md-3">
      <button class="btn btn-outline-secondary w-100" (click)="clearFilters()" aria-label="Clear all filters">
        <i class="fas fa-times" aria-hidden="true"></i> Clear Filters
      </button>
    </div>
    <div class="col-md-3">
      <button class="btn btn-outline-primary w-100" (click)="loadOrders()" aria-label="Refresh orders">
        <i class="fas fa-sync-alt" aria-hidden="true"></i> Refresh Orders
      </button>
    </div>
  </div>

  <!-- Orders Table -->
  <div class="table-responsive">
    <table class="table table-striped" *ngIf="!isLoading && orders.length" role="table" aria-label="Orders list">
      <thead class="table-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Product</th>
          <th scope="col">Buyer</th>
          <th scope="col">Seller</th>
          <th scope="col">Total</th>
          <th scope="col">Platform Fee</th>
          <th scope="col">Status</th>
          <th scope="col">Created</th>
          <th scope="col">Type</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders" [ngClass]="{'table-success': order.isSwapOrder}">
          <td>
            <span class="order-id">{{ order.id }}</span>
            <span *ngIf="order.relatedOrderId" class="badge bg-info ms-1">
              Linked with #{{ order.relatedOrderId }}
            </span>
          </td>
          <td>
            <div class="product-info">
              <span class="product-title">{{ order.productTitle || 'N/A' }}</span>
              <span *ngIf="order.isSwapOrder" class="badge bg-success ms-2">
                <i class="fas fa-exchange-alt"></i> Exchange
              </span>
            </div>
          </td>
          <td>{{ order.buyerName || 'N/A' }}</td>
          <td>{{ order.sellerName || 'N/A' }}</td>
          <td>
            <span class="amount" [ngClass]="{'text-success': order.isSwapOrder}">
              {{ order.totalAmount | number:'1.2-2' }}
            </span>
          </td>
          <td>
            <span class="platform-fee" [ngClass]="{'text-muted': order.isSwapOrder}">
              {{ order.platformFee | number:'1.2-2' }}
              <small *ngIf="order.isSwapOrder" class="d-block text-muted">(No fee)</small>
            </span>
          </td>
          <td>
             <select class="form-select form-select-sm"

                    [ngClass]="{'border-success': order.isSwapOrder}"
                    [ngModel]="getStatusStringFromEnum(order.status)"
                    (ngModelChange)="onStatusChange(order, $event)">
              <option [ngValue]="'Pending'">Pending</option>
              <option [ngValue]="'Paid'">Paid</option>
              <option [ngValue]="'Shipped'">Shipped</option>
              <option [ngValue]="'Completed'">Completed</option>
              <option [ngValue]="'Cancelled'">Cancelled</option>
            </select>
            <!-- <span [class]="getStatusBadgeClass(order)" > {{order.status}}</span> -->
          </td>
          <td>{{ order.createdAt ? (order.createdAt | date:'short') : 'N/A' }}</td>
          <td>
            <span *ngIf="order.isSwapOrder" class="badge bg-success">
              <i class="fas fa-exchange-alt"></i> Exchange
            </span>
            <span *ngIf="!order.isSwapOrder" class="badge bg-primary">
              <i class="fas fa-shopping-cart"></i> Normal
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button
                type="button"
                class="btn btn-md btn-outline-danger"
                [disabled]="isCancelling[order.id]"
                (click)="cancelOrder(order.id)"
                title="Cancel Order">
                <i class="fas fa-times" *ngIf="!isCancelling[order.id]"></i>
                <span class="spinner-border spinner-border-sm" *ngIf="isCancelling[order.id]"></span>
              </button>

              <!-- <button
                type="button"
                class="btn btn-sm btn-outline-success"
                [disabled]="isProcessing[order.id]"
                (click)="completeOrder(order.id)"
                title="Complete Order">
                <i class="fas fa-check" *ngIf="!isProcessing[order.id]"></i>
                <span class="spinner-border spinner-border-sm" *ngIf="isProcessing[order.id]"></span>
              </button> -->
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Orders Message -->
  <div *ngIf="!isLoading && !orders.length" class="alert alert-info" role="status">
    <i class="fas fa-info-circle" aria-hidden="true"></i> No orders found.
  </div>
</div>
