<div class="container">
  <h2 class="mb-4">Admin User List</h2>
  
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="my-3 text-center" role="status" aria-live="polite">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading users...</span>
    </div>
  </div>
  
  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i> {{ errorMessage }}
  </div>
  
  <!-- Add Category Button -->
  <button class="btn btn-success mb-3" (click)="showAddCategory = true">
    <i class="fas fa-plus" aria-hidden="true"></i> إضافة تصنيف جديد
  </button>
  
  <!-- Category Form -->
  <app-category-form *ngIf="showAddCategory" (categoryAdded)="onCategoryAdded()" (cancel)="showAddCategory = false"></app-category-form>
  
  <!-- Search and Filter Controls -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="searchInput" class="visually-hidden">Search users</label>
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search" aria-hidden="true"></i></span>
        <input type="text" 
               id="searchInput"
               class="form-control" 
               placeholder="Search users... (Press Enter to search)" 
               [(ngModel)]="searchTerm" 
               (input)="searchUsers()"
               (keydown.enter)="searchUsers()"
               aria-label="Search users by name or email">
      </div>
    </div>
    <div class="col-md-3">
      <label for="statusFilter" class="visually-hidden">Filter by status</label>
      <select id="statusFilter" class="form-select" [(ngModel)]="statusFilter" (change)="searchUsers()" aria-label="Filter users by status">
        <option value="">All Statuses</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
    <div class="col-md-3">
      <button class="btn btn-outline-secondary w-100" (click)="clearFilters()" aria-label="Clear all filters">
        <i class="fas fa-times" aria-hidden="true"></i> Clear Filters
      </button>
    </div>
  </div>
  
  <!-- Users Table -->
  <div class="table-responsive">
    <table class="table table-striped" *ngIf="!isLoading && users.length" role="table" aria-label="Users list">
      <thead class="table-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Name</th>
          <th scope="col">Email</th>
          <th scope="col">Status</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users">
          <td>{{ user.id }}</td>
          <td>{{ user.FullName || user.fullName || 'N/A' }}</td>
          <td>{{ user.email }}</td>
          <td>
            <span [class]="adminUserService.getUserStatusBadgeClass(user)" [attr.aria-label]="'User status: ' + getUserStatusText(user)">
              {{ getUserStatusText(user) }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group" [attr.aria-label]="'Actions for user ' + (user.FullName || user.email)">
              <button class="btn btn-danger btn-sm me-1" 
                      [disabled]="isDeleting[user.id]" 
                      (click)="confirmDelete(user)"
                      title="Delete user permanently"
                      [attr.aria-label]="'Delete user ' + (user.FullName || user.email)">
                <span *ngIf="isDeleting[user.id]" class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                <i class="fas fa-trash" *ngIf="!isDeleting[user.id]" aria-hidden="true"></i> Delete
              </button>
              <button 
                [class]="getLockButtonClass(user) + ' btn-sm me-1'" 
                [disabled]="isLocking[user.id]" 
                (click)="confirmLock(user)"
                [title]="adminUserService.isUserLocked(user) ? 'Unlock user account' : 'Lock user account'"
                [attr.aria-label]="(adminUserService.isUserLocked(user) ? 'Unlock' : 'Lock') + ' user ' + (user.FullName || user.email)">
                <span *ngIf="isLocking[user.id]" class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                <i class="fas fa-lock" *ngIf="!adminUserService.isUserLocked(user) && !isLocking[user.id]" aria-hidden="true"></i>
                <i class="fas fa-unlock" *ngIf="adminUserService.isUserLocked(user) && !isLocking[user.id]" aria-hidden="true"></i>
                {{ getLockButtonText(user) }}
              </button>
              <button 
                [class]="getAdminButtonClass(user) + ' btn-sm'" 
                [disabled]="isAssigning[user.id]" 
                (click)="assignAdmin(user)"
                [title]="user.roles?.includes('Admin') ? 'Remove admin privileges' : 'Grant admin privileges'"
                [attr.aria-label]="(user.roles?.includes('Admin') ? 'Remove admin role from' : 'Make admin') + ' user ' + (user.FullName || user.email)">
                <span *ngIf="isAssigning[user.id]" class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                <i class="fas fa-user-shield" *ngIf="!isAssigning[user.id]" aria-hidden="true"></i>
                {{ getAdminButtonText(user) }}
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Pagination Controls -->
  <div *ngIf="!isLoading && totalPages > 1" class="pagination-container d-flex justify-content-between align-items-center mt-4">
    <!-- Display Info and Page Size -->
    <div class="d-flex align-items-center gap-3">
      <div class="pagination-info">
        {{ getDisplayInfo() }}
      </div>
      
      <!-- Page Size Selector -->
      <div class="d-flex align-items-center gap-2">
        <label for="pageSizeSelect" class="form-label mb-0 small">Show:</label>
        <select id="pageSizeSelect" 
                class="form-select form-select-sm" 
                style="width: auto;"
                [value]="pageSize"
                (change)="onPageSizeChange($event)"
                [disabled]="isLoading">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
        </select>
        <span class="small text-muted">per page</span>
      </div>
    </div>
    
    <!-- Pagination -->
    <nav aria-label="Users pagination">
      <ul class="pagination pagination-sm mb-0">
        <!-- Previous Page -->
        <li class="page-item" [class.disabled]="currentPage === 1 || isLoading">
          <button class="page-link" 
                  (click)="previousPage()" 
                  [disabled]="currentPage === 1 || isLoading"
                  aria-label="Previous page">
            <i class="fas fa-chevron-left" aria-hidden="true"></i>
          </button>
        </li>
        
        <!-- Page Numbers -->
        <li class="page-item" 
            *ngFor="let page of getPageNumbers()" 
            [class.active]="page === currentPage">
          <button class="page-link" 
                  (click)="goToPage(page)"
                  [disabled]="isLoading"
                  [attr.aria-label]="'Page ' + page"
                  [attr.aria-current]="page === currentPage ? 'page' : null">
            {{ page }}
          </button>
        </li>
        
        <!-- Next Page -->
        <li class="page-item" [class.disabled]="currentPage === totalPages || isLoading">
          <button class="page-link" 
                  (click)="nextPage()" 
                  [disabled]="currentPage === totalPages || isLoading"
                  aria-label="Next page">
            <i class="fas fa-chevron-right" aria-hidden="true"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>
  
  <!-- No Users Message -->
  <div *ngIf="!isLoading && !users.length" class="alert alert-info" role="status">
    <i class="fas fa-info-circle" aria-hidden="true"></i> No users found.
  </div>
</div> 